<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JoshuaZhang</title>
    <meta name="description" content="">
    <meta name="author" content="Joshz">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://www.joshuazhang.net/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://www.joshuazhang.net/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://www.joshuazhang.net/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://www.joshuazhang.net/theme/local.css" rel="stylesheet">    <link href="http://www.joshuazhang.net/theme/pygments.css" rel="stylesheet">
    <!-- Python-Markdown CodeHilite extension css -->
    <link href="http://www.joshuazhang.net/theme/codehilite.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://www.joshuazhang.net">JoshuaZhang</a>

        <div class="nav-collapse">
        <ul class="nav">
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<!--<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
<script src="http://libs.cncdn.cn/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<!-- <script type="text/javascript" src="http://pkuwwt.gitcafe.com/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->

    <div class='article'>
        <div class="content-title">
            <a href="http://www.joshuazhang.net/posts/2012/latex-pelican.html"><h1>Pelican 的 LaTeX 集成</h1></a>
周六 18 二月 2012

by <a class="url fn" href="http://www.joshuazhang.net/author/joshz.html">Joshz</a>
 


 
        </div>
        
        <div><p>本文主要用于测试 Pelican 与 MathJax 配合显示数学公式。</p>
<h2 id="pelican-mathjax">为 Pelican 添加 MathJax 支持</h2>
<p>鉴于并非每篇文章都会有数学公式，而<code>MathJax.js</code>的资源加载在国内并不稳定，因此只在需要显示数学公式的 HTML 文件里才添加<code>MathJax CDN</code>。一个简单的方法是在需要公式显示的文章里加入<code>mathjax=true</code>的元数据声明：</p>
<div class="codehilite"><pre>Markdown Style
Mathjax: true

reST Style
:mathjax: true

HTML Style
&lt; meta name=&quot;mathjax&quot; content=&quot;true&quot; /&gt;
</pre></div>


<p>然后还需要在 Pelican 的主题模板文件中添加判断是否需要启用 MathJax 的<code>Jinja</code>代码，将以下代码保存在空文件<code>THEME/templates/mathjax.html</code>中：</p>
<div class="codehilite"><pre><span class="c">{# LaTeX mathjax support</span>
<span class="c">    If the post has metadata &quot;mathjax=true&quot;, then add mathjax cdn support</span>
<span class="c">#}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">article.mathjax</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;script type=&quot;text/x-mathjax-config&quot;&gt;</span>
<span class="x">  MathJax.Hub.Config({</span>
<span class="x">    tex2jax: {</span>
<span class="x">      inlineMath: [ [&#39;$&#39;,&#39;$&#39;], [&quot;\\(&quot;,&quot;\\)&quot;] ],</span>
<span class="x">      processEscapes: true</span>
<span class="x">    }</span>
<span class="x">  });</span>
<span class="x">&lt;/script&gt;</span>
<span class="x">&lt;script type=&quot;text/javascript&quot; src=&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;&gt;&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>


<p>官方的CDN国内无法稳定地加载，加速国内访问可以使用 <a href="http://www.freecdn.cn/">www.freecdn.cn</a> 或者<code>GitCafe</code>上的地址：</p>
<div class="codehilite"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://libs.cncdn.cn/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;http://pkuwwt.gitcafe.com/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>


<p>在需要判断是否开启 MathJax 的模板文件中（比如<code>index.html</code>、<code>article.html</code>等可能需要显示公式的模板）的合适位置添加<code>{% include "mathjax.html" %}</code></p>
<h2 id="_1">公式编辑</h2>
<h3 id="html">HTML 文档</h3>
<p><code>MathJax.js</code>的作用是把 HTML 源文件中的公式 Block 转换为 CSS 的字体和位置控制代码
。公式块的声明有三种：</p>
<div class="codehilite"><pre><span class="s">\(</span><span class="nb"> ... Inline Equation ... </span><span class="s">\)</span>

<span class="sb">\[</span><span class="nb"> ... Displayed Equation ... </span><span class="s">\]</span>

<span class="sb">$$</span><span class="nb"> ... Displayed Equation ... </span><span class="s">$$</span>
</pre></div>


<p>默认唯独不支持<code>$ ... Inline Equation ... $</code>方式（可手动设置，见上）。</p>
<h3 id="markdown">Markdown</h3>
<p>Markdown 文本首先需要被转换为 HTML 文档，而后在浏览器中渲染时<code>MathJax.js</code>才会寻找定义
的公式块。由于 Markdown 无法识别 MathJax 定义的公式块，因此公式块内的文本都会被当成普通文本处理，一些特殊符号尤其需要特别注意，比如<code>\</code>和<code>_</code>、<code>*</code>这几个字符，前一个为 Markdown 转义符，后两个为强调指示符。</p>
<p>由于 Pelican 使用的 Markdown 解析器是<a href="https://pythonhosted.org/Markdown/index.html">Python-Markdown</a>，而它默认禁用了<a href="https://pythonhosted.org/Markdown/#differences">下划线强调规则</a>，因此公式中的<code>_</code>一般情况都不会被转换为<code>&lt;em&gt;&lt;/em&gt;</code>，但<code>*</code>和<code>\</code>解析的麻烦仍然存在。</p>
<p>一个<code>*</code>解析的示例：</p>
<div class="codehilite"><pre>$$ x*y*z=100 $$
</pre></div>


<p>Markdown 转换为 HTML 的结果为：</p>
<div class="codehilite"><pre><span class="nt">&lt;p&gt;</span>$$ x<span class="nt">&lt;em&gt;</span>y<span class="nt">&lt;/em&gt;</span>z=100 $$<span class="nt">&lt;/p&gt;</span>
</pre></div>


<p>此处作为乘号的两个<code>*</code>被识别成强调指示符，正确的代码应为：</p>
<div class="codehilite"><pre>$$ x\*y\*z=100 $$
</pre></div>


<p>渲染结果如下：
$$ x*y*z=100 $$</p>
<p><code>\</code>解析问题以洛伦兹方程为例：</p>
<div class="codehilite"><pre>\[\begin{aligned}
\dot{x} &amp; = \sigma(y-x) \\
\dot{y} &amp; = \rho x - y - xz \\
\dot{z} &amp; = -\beta z + xy
\end{aligned}\]
</pre></div>


<p>Markdown 转换为 HTML 的结果如下：</p>
<div class="codehilite"><pre>&lt;p&gt;[\begin{aligned}
\dot{x} = \sigma(y-x) \
\dot{y} = \rho x - y - xz \
\dot{z} = -\beta z + xy
\end{aligned}]&lt;/p&gt;
</pre></div>


<p>注意<code>\a-z</code>的解析不受影响，而$\LaTeX$的换行代码<code>\\</code>被转换为<code>\</code>，
<code>\[</code>被转换为<code>[</code>，显然这不是想要的结果。为了得到正确的解析结果，公式代码必须改为：</p>
<div class="codehilite"><pre>\\[\begin{aligned}
\dot{x} &amp; = \sigma(y-x) \\\\
\dot{y} &amp; = \rho x - y - xz \\\\
\dot{z} &amp; = -\beta z + xy
\end{aligned}\\]
</pre></div>


<p>显示结果如下：
\[\begin{aligned}
\dot{x} &amp; = \sigma(y-x) \\
\dot{y} &amp; = \rho x - y - xz \\
\dot{z} &amp; = -\beta z + xy
\end{aligned}\]</p>
<p>通过上面的例子可见通过添加 Markdown 转义符<code>\</code>可以有效解决各种转换问题，手工调整的方法虽然繁琐，但不失简单直接，如果公式不多不复杂这样做成本很低。对于强迫症患者或者要求较高的童鞋，还可以参考<a href="http://gohugo.io/tutorials/mathjax/">这里的方法</a>
。它可以解决所有特殊符号解析的难题，只要保证<code>CSS</code>和<code>MathJax</code>设置一致，使用其它 Markdown
解析器处理也不会有问题。其思路是将公式写入 Markdown 不处理的<code>verbatim</code>环境中，在 MathJax
 设置中加入对<code>code</code>标签内容的渲染并设置一个合适的式样。</p>
<p>此外，我们也可以使用 Python-Markdown 的扩展 <a href="https://github.com/mayoff/python-markdown-mathjax">python-markdown-mathjax</a>，
缺点是安装以及设置较麻烦，而且个人支持难以长久，未来可能需要自己修改代码。</p>
<p>目前个人使用最朴实的方案，只要书写时稍作注意即可。</p>
<p>Cauchy-Schwarz不等式：</p>
<div class="codehilite"><pre>\\[ \left( \sum_{k=1}^n a_k b_k \right)^2 \leq \left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right) \\]
</pre></div>


<p>\[ \left( \sum_{k=1}^n a_k b_k \right)^2 \leq \left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right) \]</p>
<h3 id="rest">reST</h3>
<h2 id="_2">测试</h2>
<p>毕达哥拉斯定理：<code>\\(a^2+b^2=c^2\\)</code>，\(a^2+b^2=c^2\)</p>
<p>正态分布：</p>
<div class="codehilite"><pre>$$f\left(x\right)=\frac{1}{\sqrt{2\pi}\sigma}exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)$$
</pre></div>


<p>$$f\left(x\right)=\frac{1}{\sqrt{2\pi}\sigma}exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)$$</p>
<p>傅里叶变换：</p>
<div class="codehilite"><pre>\\[F\left(\omega\right)=\mathcal{F}\left[f(t)\right]=\int_{-\infty}^{\infty}e^{-i\omega T}dt\\]
</pre></div>


<p>\[F\left(\omega\right)=\mathcal{F}\left[f(t)\right]=\int_{-\infty}^{\infty}e^{-i\omega T}dt\]</p>
<p>傅里叶逆变换：</p>
<div class="codehilite"><pre>\\[f\left(t\right)=\mathcal{F}^{-1}\left[F\left(\omega\right)\right]=\frac{1}{2\pi}\int_{-\infty}^{\infty}F\left(\omega\right)e^{i\omega t}d\omega\\]
</pre></div>


<p>\[f\left(t\right)=\mathcal{F}^{-1}\left[F\left(\omega\right)\right]=\frac{1}{2\pi}\int_{-\infty}^{\infty}F\left(\omega\right)e^{i\omega t}d\omega\]</p>
<p>MathJax的语法基本与latex一致，可以参考wikipedia的latex书写语法规范<a href="http://zh.wikipedia.org/wiki/Help:%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">Help:数学公式</a></p></div>
        <hr />
    </div>
		
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://www.joshuazhang.net/tag/mathjax.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Next</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://www.joshuazhang.net/archives.html">Archives</a>
                <li><a href="http://www.joshuazhang.net/tags.html">Tags</a>
                <li><a href="http://www.joshuazhang.net/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://www.joshuazhang.net/category/.html"></a></li>
                <li><a href="http://www.joshuazhang.net/category/life.html">Life</a></li>
                <li><a href="http://www.joshuazhang.net/category/review.html">Review</a></li>
                <li><a href="http://www.joshuazhang.net/category/technique.html">Technique</a></li>
                   
            </ul>
            </div>




            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/voidmous">Github</a></li>
                <li><a href="http://www.douban.com/people/45448149">Douban</a></li>
                <li><a href="http://weibo.com/u/1760438435">Weibo</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://www.joshuazhang.net">JoshuaZhang</a> &copy; Joshz 2012-2014 Powered By <a href="http://docs.getpelican.com/en/3.1.1/">Pelican</a> and <a href="https://github.com/">Github</a></p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.useso.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-40506321-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
</body>
</html>